!function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={exports:{},id:r,loaded:!1};return e[r].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");i(1);var r;AFRAME.registerSystem("audio-visualizer",{init:function(){this.analysers={}},getOrCreateAnalyser:function(e){r||(r=new AudioContext);var t=this.analysers,i=r.createAnalyser(),n=e.src,a=n.getAttribute("src");if(t[a])return t[a];var s=r.createMediaElementSource(n);return s.connect(i),i.connect(r.destination),i.smoothingTimeConstant=e.smoothingTimeConstant,i.fftSize=e.fftSize,t[a]=i,t[a]}}),AFRAME.registerComponent("audio-visualizer",{schema:{fftSize:{"default":2048},smoothingTimeConstant:{"default":.8},src:{type:"selector"},unique:{"default":!1}},init:function(){this.analyser=null,this.spectrum=null},update:function(){function e(e){t.analyser=e,t.spectrum=new Uint8Array(t.analyser.frequencyBinCount),t.el.emit("audio-analyser-ready",{analyser:e})}var t=this,i=this.data,r=this.system;i.src&&e(i.unique?r.createAnalyser(i):r.getOrCreateAnalyser(i))},tick:function(){this.analyser&&this.analyser.getByteFrequencyData(this.spectrum)}}),AFRAME.registerComponent("audio-visualizer-kick",{dependencies:["audio-visualizer"],schema:{decay:{"default":.02},frequency:{"default":[0,10]},threshold:{"default":.3}},init:function(){this.currentThreshold=this.data.threshold,this.kicking=!1},tick:function(){var e=this.data,t=this.el;if(t.components["audio-visualizer"].spectrum){var i=this.maxAmplitude(e.frequency);if(i>this.currentThreshold&&i>e.threshold){if(this.kicking)return;this.kicking=!0,t.emit("audio-visualizer-kick-start",{currentThreshold:this.currentThreshold,magnitude:i})}else this.currentThreshold-=e.decay,this.kicking&&(this.kicking=!1,t.emit("audio-visualizer-kick-end",{currentThreshold:this.currentThreshold,magnitude:i}))}},maxAmplitude:function(e){var t=0,i=this.el.components["audio-visualizer"].spectrum;if(!e.length)return e<i.length?i[~~e]:null;for(var r=e[0],n=e[1];n>=r;r++)i[r]>t&&(t=i[r]);return t}})},function(e,t){AFRAME.registerComponent("audio-visualizer-spectrum-scale",{dependencies:["audio-visualizer"],schema:{max:{"default":20},multiplier:{"default":100}},tick:function(e){var t=this.el.components["audio-visualizer"].spectrum;if(t)for(var i=this.el.children,r=this.data,n=0;n<i.length;n++)i[n].setAttribute("scale",{x:1,y:Math.min(r.max,Math.max(t[n]*r.multiplier,.05)),z:1})}})}]);